@model LOLAWebsite.Models.StripeChargeModel


@{
    ViewBag.Title = "Charge";
}
<!-- Header -->
<a name="about"></a>
<div class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="intro-message">
                    <!-- LOLA Logo-->
                    <img src="~/img/logo.jpg" id="homelogo" />
                    <hr class="intro-divider">
                    <h1></h1>
                </div>
            </div>
        </div>
    </div>
    <!-- /.container -->
</div>
<!-- /.intro-header -->

<div class="container navbarpad">
    <div class="col-md-5">
        <h4>Register for Course</h4>
        <hr />
            <dl class="dl-horizontal">
                <dt>
                    <span>Card Number</span>
                </dt>
                <dd>
                    <input type="text" name="CardNumber" id="txtCardNumber" class="form-control" placeholder="Card Number e.g 1234..." />
                </dd>
                <dt>
                    <span>CVC</span>
                </dt>
                <dd>
                    <input type="text" name="Cvc" id="txtCvc" class="form-control" placeholder="Security Code e.g 987" />
                </dd>
                <dt>
                    <span>Expiration Month</span>
                </dt>
                <dd>
                    <input type="text" name="ExpiryMonth" id="txtExpiryMonth" class="form-control" placeholder="01" />
                </dd>
                <dt>
                    <span>Expiration Year</span>
                </dt>
                <dd>
                    <input type="text" name="ExpiryYear" id="txtExpiryYear" class="form-control" placeholder="2015" />
                </dd>
            </dl>
        @using (Html.BeginForm("Charge", "Course_Registration", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { @class = "form-horizontal", role = "form", id = "frmCharge" }))
        {
            @Html.AntiForgeryToken()
            <dl class="dl-horizontal">
                <dt>
                   Card Holder Name
                </dt>
                <dd>
                    @Html.TextBoxFor(model => model.CardHolderName, new { id = "txtCardHolderName", @class = "form-control" })
                </dd>
                <dt>
                    Address Line 1
                </dt>
                <dd>
                    @Html.TextBoxFor(model => model.AddressLine1, new { id = "txtAddress1", @class = "form-control" })
                </dd>
                <dt>
                    Address Line 2
                </dt>
                <dd>
                    @Html.TextBoxFor(model => model.AddressLine2, new { id = "txtAddress2", @class = "form-control" })
                </dd>
                <dt>
                    City
                </dt>
                <dd>
                    @Html.TextBoxFor(model => model.AddressCity, new { id = "txtCity", @class = "form-control" })
                </dd>
                <dt>
                   State
                </dt>
                <dd>
                    @Html.TextBoxFor(model => model.AddressState, new { id = "txtState", @class = "form-control" })
                </dd>
                <dt>
                    Zip Code
                </dt>
                <dd>
                    @Html.TextBoxFor(model => model.AddressPostcode, new { id = "txtPostcode", @class = "form-control" })
                </dd>
            </dl>
            <p>
                @Html.HiddenFor(model => model.Token, new { id = "hdnToken" })

                @Html.ActionLink("ProcessPayment", "Charge",null, new { id = "btnCharge", @class="btn btn-default" })
            </p>
        }
        @section Scripts {
            <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
            <script type="text/javascript">
            $('document').ready(function() {
                Stripe.setPublishableKey('pk_test_HoPqOGqtlmgKQ3dWeVvbZFgA');

                $('#btnCharge').on('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    Stripe.card.createToken({
                        number: $('#txtCardNumber').val(),
                        cvc: $('#txtCvc').val(),
                        exp_month: $('#txtExpiryMonth').val(),
                        exp_year: $('#txtExpiryYear').val()
                    }, stripeResponseHandler);
                });

                function stripeResponseHandler(status, response) {
                    var $form = $('#frmCharge');

                    if (response.error) {
                        // Show the errors on the form
                        alert(response.error.message);
                    } else {
                        // response contains id and card, which contains additional card details
                        var token = response.id;
                        // Insert the token into the form so it gets submitted to the server
                        $('#hdnToken').val(token);
                        // and submit
                        $form.get(0).submit();
                    }
                }
            });
            </script>
            }
    </div>
</div>